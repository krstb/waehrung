<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Währungsumrechner</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png"> 
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta name="theme-color" content="#000000">
    <meta name="color-scheme" content="light">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script>
      // Service Worker Registrierung
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .catch(err => console.log('SW Fehler:', err));
        });
      }
    </script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>

    /* Fix für PWA-Ränder */
    html {background-color: #000000 !important;}
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #D2FF00; /* light blue background */
    }
    .shadow-3xl {
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
  </style>
</head>
<body class="flex items-start justify-center min-h-screen p-4 pt-4">
  
  <div class="bg-white p-8 rounded-3xl shadow-3xl w-full max-w-lg border border-gray-100">
    <h1 class="text-3xl font-bold text-center text-slate-800 mb-8">Währung</h1>
    
    <div class="mb-6">
      <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Betrag</label>
      <input type="number" id="amount" placeholder="Geben Sie den Betrag ein"
             class="mt-1 block w-full px-4 py-3 border-2 border-gray-300 rounded-xl shadow-inner placeholder-gray-400
                    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
    </div>

    <div class="flex flex-col md:flex-row items-center justify-between space-y-6 md:space-y-0 md:space-x-4 mb-8">
      <div class="relative w-full md:w-5/12">
        <label for="from-currency" class="block text-sm font-medium text-gray-700 mb-1">Von</label>
        <select id="from-currency"
                class="mt-1 block w-full px-4 py-3 border-2 border-gray-300 rounded-xl shadow-inner
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none
                       bg-white cursor-pointer pr-10">
          </select>
        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
      
      <button id="swap-btn" class="p-3 rounded-full bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 w-full md:w-auto shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
        </svg>
      </button>

      <div class="relative w-full md:w-5/12">
        <label for="to-currency" class="block text-sm font-medium text-gray-700 mb-1">Zu</label>
        <select id="to-currency"
                class="mt-1 block w-full px-4 py-3 border-2 border-gray-300 rounded-xl shadow-inner
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none
                       bg-white cursor-pointer pr-10">
          </select>
        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
    </div>

    <div id="result" class="mt-8 text-center text-xl font-bold text-gray-800 min-h-[4rem] bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-sm">
      &nbsp;
      </div>
  </div>

  <script>
    const amountInput = document.getElementById('amount');
    const fromCurrencySelect = document.getElementById('from-currency');
    const toCurrencySelect = document.getElementById('to-currency');
    const swapBtn = document.getElementById('swap-btn');
    const resultDiv = document.getElementById('result');
    const swapIcon = swapBtn.querySelector('svg');

    // Funktion zur Debounce von Funktionsaufrufen
    function debounce(func, delay) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), delay);
      };
    }

    // Funktion zur Formatierung von Zahlen
    function formatNumber(number) {
        return new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(number);
    }

    async function populateCurrencyDropdowns() {
      const API_URL = 'https://open.er-api.com/v6/latest/EUR';
      try {
        const response = await fetch(API_URL);
        const data = await response.json();

        if (data.result === 'success') {
          const currencies = Object.keys(data.rates).sort();
          const namesResponse = await fetch('https://openexchangerates.org/api/currencies.json');
          const namesData = await namesResponse.json();

          currencies.forEach(currency => {
            const fullName = namesData[currency] || currency;
            const option1 = document.createElement('option');
            option1.value = currency;
            option1.textContent = `${currency} - ${fullName}`;
            fromCurrencySelect.appendChild(option1);

            const option2 = document.createElement('option');
            option2.value = currency;
            option2.textContent = `${currency} - ${fullName}`;
            toCurrencySelect.appendChild(option2);
          });
          
          fromCurrencySelect.value = localStorage.getItem('fromCurrency') || 'USD';
          toCurrencySelect.value = localStorage.getItem('toCurrency') || 'EUR';
        } else {
          throw new Error('Fehler beim Abrufen der Währungsliste.');
        }
      } catch (error) {
        console.error('Fetch-Fehler:', error);
        resultDiv.textContent = 'Fehler beim Laden der Währungen.';
        resultDiv.classList.add('text-red-500');
      }
    }

    async function convertCurrency() {
      const amount = parseFloat(amountInput.value);
      const fromCurrency = fromCurrencySelect.value;
      const toCurrency = toCurrencySelect.value;
      
      localStorage.setItem('fromCurrency', fromCurrency);
      localStorage.setItem('toCurrency', toCurrency);
      localStorage.setItem('lastAmount', amountInput.value);

      if (isNaN(amount) || amount <= 0) {
        resultDiv.textContent = 'Bitte geben Sie einen gültigen Betrag ein.';
        resultDiv.classList.add('text-red-500');
        return;
      }
      
      if (fromCurrency === toCurrency) {
        const resultText = `${formatNumber(amount)} ${fromCurrency.split(' - ')[0]}<br>=<br>${formatNumber(amount)} ${toCurrency.split(' - ')[0]}`;
        resultDiv.innerHTML = resultText;
        resultDiv.classList.remove('text-red-500');
        return;
      }

      try {
        resultDiv.classList.remove('text-red-500');
        
        const API_URL = `https://open.er-api.com/v6/latest/${fromCurrency.split(' - ')[0]}`;
        const response = await fetch(API_URL);
        const data = await response.json();

        if (data.result === 'success' && data.rates[toCurrency.split(' - ')[0]]) {
          const exchangeRate = data.rates[toCurrency.split(' - ')[0]];
          const convertedAmount = amount * exchangeRate;
          const resultText = `${formatNumber(amount)} ${fromCurrency.split(' - ')[0]}<br>=<br>${formatNumber(convertedAmount)} ${toCurrency.split(' - ')[0]}`;
          resultDiv.innerHTML = resultText;
        } else {
          throw new Error('Wechselkurs konnte nicht ermittelt werden.');
        }
      } catch (error) {
        resultDiv.textContent = error.message;
        resultDiv.classList.add('text-red-500');
      }
    }
    
    function swapCurrencies() {
      const tempValue = fromCurrencySelect.value;
      fromCurrencySelect.value = toCurrencySelect.value;
      toCurrencySelect.value = tempValue;
      
      convertCurrency();
    }

    window.onload = () => {
        populateCurrencyDropdowns().then(() => {
            const lastAmount = localStorage.getItem('lastAmount');
            if (lastAmount) {
                amountInput.value = lastAmount;
                convertCurrency();
            }
        });

        const debouncedConvert = debounce(convertCurrency, 500);

        amountInput.addEventListener('input', debouncedConvert);
        fromCurrencySelect.addEventListener('change', convertCurrency);
        toCurrencySelect.addEventListener('change', convertCurrency);
        swapBtn.addEventListener('click', swapCurrencies);
    };
  </script>

</body>
</html>
